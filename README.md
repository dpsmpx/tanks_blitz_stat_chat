Anamota Dideri, [22.11.2025 16:10]
# Voice Control for Tanks

Это Python-скрипт для голосового управления и отслеживания статистики в игре "World of Tanks" (или аналогичных танковых симуляторах). Скрипт использует распознавание речи для обработки команд, отображает оверлей с реал-тайм статистикой сессии и позволяет отправлять сообщения в игровой чат. Данные сессий сохраняются в JSON-файле для последующего анализа.

## 1. Назначение и функции

### Назначение
Скрипт предназначен для игроков в "World of Tanks", которые хотят автоматизировать отслеживание статистики сессии (бои, урон, win rate) с помощью голосовых команд. Он упрощает ввод данных во время игры, минимизируя использование клавиатуры и мыши. Основные компоненты:
- Голосовое распознавание: Обработка команд на русском языке для управления сессией.
- Оверлей: Полупрозрачное окно с реал-тайм статистикой, которое всегда поверх других окон.
- Озвучивание ответов: Скрипт "говорит" статистику и подтверждения с помощью TTS (text-to-speech).
- Отправка сообщений в чат: Голосовая команда для ввода текста в игровой чат.
- Сохранение данных: Статистика сессий хранится в tank_stats.json для истории.

Скрипт работает в фоновом режиме, не мешая игре, и использует микрофон для ввода команд.

### Основные функции
- Управление сессиями:
  - Начать новую сессию: Команда "Новая сессия [название танка]" (например, "Новая сессия Т-34").
  - Завершить сессию: "Конец сессии" или "Завершить сессию".
- Отслеживание боев:
  - Добавить урон: Просто скажите число (например, "500" — добавит 500 урона к текущему бою).
  - Завершить бой победой: "Победа" или "Виктори".
  - Завершить бой поражением: "Поражение" или "Луз".
  - Отмена последнего урона: "Отмена" или "Назад".
- Статистика:
  - Показать текущую статистику: "Статус" или "Статистика" — озвучит win rate и средний урон.
  - Автоматическое озвучивание статистики после каждого боя.
- Чат:
  - Отправить сообщение: "Чат [текст]" (например, "Чат всем привет" — отправит "всем привет" в игровой чат с помощью симуляции нажатий клавиш).
- Помощь:
  - "Помощь" или "Команды" — выведет список команд в консоль и озвучит подтверждение.
- Оверлей:
  - Отображает: Название танка, время сессии, количество боев, win rate, средний урон, текущий урон в бою (+ последний добавленный урон).
  - Окно можно перетаскивать мышью; позиция сохраняется в overlay_config.json.
  - Полупрозрачное (alpha=0.8), всегда сверху, фиксированный размер (350x110 px).
- Дополнительно:
  - Непрерывное прослушивание микрофона с калибровкой шума.
  - История урона для отмены.
  - Защита от ложных срабатываний (высокий порог энергии, паузы).

Примечания по использованию:
- Скрипт ориентирован на русский язык (распознавание и TTS).
- Работает только во время активной игры (использует pyautogui для симуляции ввода).
- Не требует интернета для базовой работы, кроме TTS (gTTS использует Google API).
- Для остановки: Закройте окно GUI или используйте Ctrl+C в консоли.

## 2. Установка библиотек, настройка

### Требования
- Операционная система: Windows (рекомендуется, из-за pyautogui и tkinter). Может работать на Linux/Mac, но протестировано на Windows.
- Python: Версия 3.8+ (рекомендуется 3.10+ для стабильности).
- Микрофон: Подключенный и работающий микрофон (встроенный или внешний).
- Звук: Динамики или наушники для TTS-озвучивания.
- Игра: "World of Tanks" должна быть запущена для тестирования чата и оверлея.

### Установка библиотек
1. Установите Python: Скачайте с [official website](https://www.python.org/downloads/) и добавьте в PATH.
2. Создайте виртуальное окружение (опционально, но рекомендуется):
  
   python -m venv voice_control_env
   
   Активируйте:
   - Windows: voice_control_env\Scripts\activate
   - Linux/Mac: source voice_control_env/bin/activate

Anamota Dideri, [22.11.2025 16:10]
3. Установите зависимости с помощью pip:
  
   pip install speechrecognition pyautogui pyperclip tkinter gtts pygame
   
   - speechrecognition: Для распознавания речи (использует Google API).
   - pyautogui: Симуляция нажатий клавиш (для чата).
   - pyperclip: Работа с буфером обмена.
   - gtts: Text-to-Speech (Google TTS).
   - pygame: Воспроизведение аудио из TTS.
   - tkinter: GUI для оверлея и управления (обычно встроен в Python, но убедитесь в установке).

   Дополнительно для микрофона:
   - Установите PyAudio (требуется для speechrecognition):
    
     pip install pyaudio
     
     Если ошибка на Windows: Скачайте wheel-файл с [unofficial wheels](https://www.lfd.uci.edu/~gohlke/pythonlibs/#pyaudio) и установите pip install PyAudio‑0.2.11‑cp310‑cp310‑win_amd64.whl (замените на вашу версию Python).

   Полный список библиотек из кода:
   - speech_recognition (sr)
   - pyautogui
   - pyperclip
   - threading, time, queue (встроенные)
   - tkinter (tk, ttk)
   - json, os, datetime, tempfile (встроенные)
   - gtts
   - pygame
   - re (встроенный)

4. Проверьте установку:
   Запустите Python в терминале и импортируйте библиотеки:
  
   python
   import speech_recognition as sr
   import pyautogui
   import pyperclip
   import tkinter as tk
   from gtts import gTTS
   import pygame
   
   Если ошибок нет — всё готово.

### Настройка
1. Скачайте скрипт:
   - Сохраните код в файл voice_control.py.
   - Запустите: python voice_control.py.

2. Калибровка микрофона:
   - При первом запуске скрипт автоматически калибрует микрофон (5 секунд на фоне шума).
   - Если распознавание работает плохо: Увеличьте recognizer.energy_threshold в коде (в классе TankStatsRecorder) или запустите калибровку вручную в тихой комнате.

3. Настройка оверлея:
   - Окно появится в правом нижнем углу экрана.
   - Перетащите его мышью — позиция сохранится в overlay_config.json.
   - Альфа (прозрачность): 0.8 (можно изменить в коде: self.root.attributes('-alpha', 0.8)).

4. GUI для управления:
   - Откроется окно "Голосовой контроль для танков".
   - Нажмите "Запустить прослушивание" для старта.
   - Статус и последнее сообщение отображаются в реал-тайм.

5. Тестирование:
   - Запустите игру в оконном режиме для теста чата.
   - Скажите "Помощь" — увидите команды в консоли.
   - Скажите "Новая сессия Т-34" — начнется сессия, оверлей обновится.
   - Добавьте урон: "500".
   - Завершите бой: "Победа".
   - Проверьте чат: "Чат тест" — должно отправить "тест" в игру (Enter -> Ctrl+V -> Enter).

6. Возможные проблемы и решения:
   - Распознавание не работает: Проверьте микрофон в настройках Windows. Убедитесь, что интернет есть (Google API). Альтернатива: Измените на другой recognizer в коде (например, Sphinx для оффлайн, но хуже для русского).
   - TTS не озвучивает: Интернет требуется. Проверьте pygame: pygame.mixer.init().
   - PyAutoGUI не работает: Убедитесь, что игра в фокусе; скрипт симулирует глобальные клавиши.
   - Ошибки с правами: Запустите от администратора, если проблемы с микрофоном.
   - Ложные срабатывания: Увеличьте recognizer.pause_threshold или phrase_threshold в коде.
   - Сохранение данных: Файлы tank_stats.json и overlay_config.json создаются автоматически.

7. Безопасность:
   - Скрипт использует pyautogui — не оставляйте его запущенным без присмотра, чтобы избежать случайных действий.
   - Нет сетевых уязвимостей, кроме TTS и распознавания (Google API).

Если нужны доработки, форкните репозиторий и внесите изменения!
